<!doctype html><html lang=ja><head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Kubestronaut in 2024 - Mayo's Blog</title>
<meta name=description content="In 2024, I received the Kubestronaut certification and achieved the 9th Kubestronaut in Japan. The Kubestronaut program starts in 2nd season of 2024 and holds a special page at cncf.io/training/kubestronaut/. The program encourages individuals to take the CNCF Kubernetes examinations and get five certifications: CKA, CKAD, CKS, KCNA, and KCSA. It&rsquo;s actually the first program that benefits those who pass the certifications; you get the jacket and have the Kubestronaut">
<meta name=author content>
<link rel=preconnect href=https://cdn.jsdelivr.net>
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,700|Press+Start+2P" rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400&family=Noto+Sans+JP:wght@300;400&family=Noto+Sans+SC:wght@300;400&family=Noto+Serif:wght@300;400&family=Noto+Serif+JP:wght@300;400&family=Noto+Serif+SC:wght@300;400&family=Source+Code+Pro:wght@300;400" rel=stylesheet>
<link rel=stylesheet href="/bundle.css?v=1737040591" media=all>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/tocbot/dist/tocbot.css>
<link rel=icon href=https://github.com/mayocream.png><meta name=generator content="Hugo 0.88.1">
<link rel=canonical href=https://mayo.rocks/2025/01/kubestronaut-in-2024/><meta property="og:title" content="Kubestronaut in 2024">
<meta property="og:description" content="In 2024, I received the Kubestronaut certification and achieved the 9th Kubestronaut in Japan. The Kubestronaut program starts in 2nd season of 2024 and holds a special page at cncf.io/training/kubestronaut/. The program encourages individuals to take the CNCF Kubernetes examinations and get five certifications: CKA, CKAD, CKS, KCNA, and KCSA. It&rsquo;s actually the first program that benefits those who pass the certifications; you get the jacket and have the Kubestronaut">
<meta property="og:type" content="article">
<meta property="og:url" content="https://mayo.rocks/2025/01/kubestronaut-in-2024/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2025-01-08T15:43:21+09:00">
<meta property="article:modified_time" content="2025-01-08T15:43:21+09:00"><meta property="og:site_name" content="Mayo's Blog">
</head>
</html>
<body><script src=https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js></script>
<script>const opts={bottom:'32px',right:'unset',left:'32px',time:'0.3s',mixColor:'#fff',backgroundColor:'#fff',buttonColorDark:'#100f2c',buttonColorLight:'#fff',saveInCookies:!0,label:'üåì',autoMatchOsTheme:!0};let darkmode;window.matchMedia('only screen and (min-width: 680px)').matches?(darkmode=new Darkmode(opts),darkmode.showWidget()):(localStorage.removeItem('darkmode'),darkmode=new Darkmode(opts)),window.darkmode=darkmode,document.addEventListener('DOMContentLoaded',function(){document.body.style.opacity=1})</script>
<main class=page-content aria-label=Content>
<div class=wrapper><nav class=site-nav>
<a class=page-link href=/posts/>Posts</a>
<a class=page-link href=/about/>About</a>
</nav><header class=post-header>
<a class=site-title href=https://mayo.rocks>Mayo's Blog</a>
<h1 class="post-title baseline-fix typeface-serif" lang=ja itemprop="name headline">Kubestronaut in 2024</h1>
</header>
<div class=post-cover aria-label=Cover>
<div class=post-cover-wrapper>
<img src alt>
</div>
<div class=cover-meta></div>
</div>
<div class=post-layout>
<article class="post typeface-serif" lang=ja itemscope itemtype=http://schema.org/BlogPosting>
<div class=post-content itemprop=articleBody>
<p>In 2024, I received the Kubestronaut certification and achieved the 9th Kubestronaut in Japan. The Kubestronaut program starts in 2nd season of 2024 and holds a special page at¬†<a href=https://cncf.io/training/kubestronaut/>cncf.io/training/kubestronaut/</a>.¬†The program encourages individuals to take the CNCF Kubernetes examinations and get five certifications:¬†<a href=https://www.cncf.io/training/certification/cka/>CKA</a>,¬†<a href=https://www.cncf.io/training/certification/ckad/>CKAD</a>,¬†<a href=https://www.cncf.io/training/certification/cks/>CKS</a>,¬†<a href=https://www.cncf.io/training/certification/kcna/>KCNA</a>, and¬†<a href=https://www.cncf.io/training/certification/kcsa/>KCSA</a>. It&rsquo;s actually the first program that benefits those who pass the certifications; you get the jacket and have the Kubestronaut network.</p>
<h2 id=how-kubernetes-examinations-changed-in-2024>How Kubernetes examinations changed in 2024</h2>
<p>For those who are familiar with or passed the CKA or CKAD tests a few years ago, the test has changed and uses a brand new system to score your submission.</p>
<p>The noticeable changes from 2021:</p>
<ul>
<li>The test runs on a Debian virtual machine, and local remote desktop software is running to connect to the remote desktop.</li>
<li>The local software checks multiple monitors and only allows one monitor.</li>
<li>You upload your ID before the examination and don&rsquo;t have to show it to the interviewer every time.</li>
<li>You can&rsquo;t bring your bookmarks.</li>
<li>Scores are available after around 24 hours of taking the exam.</li>
<li>You got the k=kubectl alias in the terminal.</li>
</ul>
<p>Changes for CKA and CKAD questions:</p>
<ul>
<li>Exam questions include JSON path.</li>
<li>Manifest API deprecation included.</li>
<li>Etcd backup and restore included.</li>
</ul>
<p>These changes have improved the quality of the examination, and it&rsquo;s now a little more complicated to achieve high scores. However, they are still intermediate-level exams. As long as you prepare, passing the exam is easy.</p>
<p>The biggest problem with the exam is that you have to clean your desktop, and you cannot put non-decorated things on it. It means that there are no books, notes, and files on the desktop, no scanner, and no anime figurines :L</p>
<h2 id=lets-becomekubestronaut-event>&ldquo;Let&rsquo;s become¬†Kubestronaut&rdquo; event</h2>
<p><a href=https://community.cncf.io/events/details/cncf-cloud-native-community-japan-presents-cloud-native-community-japan-lets-become-kubestronaut/><strong>Cloud Native Community Japan - Let&rsquo;s become Kubestronaut | CNCF</strong>
<em>In-person Event - CNCF„ÅÆk8sË™çÂÆöË©¶È®ì5Á®ÆÂà∂Ë¶á„Åó„Å¶Kubestronaut„Å´„Å™„Çç„ÅÜÔºÅ</em>
<em>community.cncf.io</em></a></p>
<p>I was delighted to attend the event and speak at the discussion panel, which was my first time attending such an event. I said these exams are easy as long as you prepare for them, and let&rsquo;s connect.</p>
<p>I received my¬†Kubestronaut jacket at the event and was very pleased to wear it. I was giving the speech that I don&rsquo;t know the benefit of becoming a¬†Kubestronaut yet at the discussion panel and hoping I got hired soon. It was such a surprise that a interviewer recognized the¬†Kubestronaut jacket and I had great behalf of skills, that I will be starting my new position as a Rust Engineer at Woven by Toyota next week :)</p>
<p>For those who are wondering if there is a benefit to becoming a Kubestronaut, Yes, it will come.</p>
<h2 id=kubestronaut-cheat-sheet>Kubestronaut Cheat Sheet</h2>
<p>Pre Setup</p>
<ul>
<li><a href=https://kubernetes.io/docs/reference/kubectl/quick-reference/#interacting-with-running-pods>kubectl Quick Reference</a></li>
</ul>
<p>Shell:</p>
<pre><code>export do=&quot;--dry-run=client -o yaml&quot;    # k create deploy nginx --image=nginx $do
export now=&quot;--force --grace-period 0&quot;   # k delete pod x $now
</code></pre>
<p>Basic</p>
<p>Base64:</p>
<pre><code>echo -n &quot;admin&quot; | base64 -w0
echo -n &quot;YWRtaW4=&quot; | base64 -d
</code></pre>
<p>Find pod by container id:</p>
<pre><code>crictl ps -id &lt;container-id&gt;
crictl pods -id &lt;pod-id&gt;
</code></pre>
<p>Falco</p>
<ul>
<li><a href=https://falco.org/docs/reference/rules/supported-fields/>Supported Fields for Conditions and Outputs</a></li>
<li>edit /etc/falco/falco_rules.local.yaml</li>
<li>cat /opt/course/2/falco.log.dirty | cut -d" " -f 9 > /opt/course/2/falco.log</li>
<li>The tool cut will split input into fields using space as the delimiter (-d""). We then only select the 9th field using -f 9.</li>
</ul>
<p>API Server</p>
<p>api-server as static pod: /etc/kubernetes/manifests/kube-apiserver.yaml.</p>
<p>API server:</p>
<pre><code>- kube-apiserver
- --authorization-mode=Node,RBAC
- --etcd-servers=https://127.0.0.1:2379
- --enable-admission-plugins=NodeRestriction
# Enable audit logs
- --audit-policy-file=/etc/kubernetes/audit-policy/policy.yaml
- --audit-log-path=/etc/kubernetes/audit-logs/audit.log
- --audit-log-maxsize=7
- --audit-log-maxbackup=2
# expose
- --kubernetes-service-node-port=31000
# CIS benchmark
- --profiling=false
</code></pre>
<p>Pod Security</p>
<ul>
<li><a href=https://kubernetes.io/docs/concepts/security/pod-security-standards/#baseline>Pod Security Standards</a></li>
<li><a href=https://kubernetes.io/docs/concepts/security/pod-security-admission/>Pod Security Admission</a></li>
<li><a href=https://kubernetes.io/docs/tasks/configure-pod-container/security-context/>Security Context</a></li>
</ul>
<pre><code># MODE must be one of `enforce`, `audit`, or `warn`.
# LEVEL must be one of `privileged`, `baseline`, or `restricted`.
pod-security.kubernetes.io/&lt;MODE&gt;: &lt;LEVEL&gt;
</code></pre>
<p>CIS Benchmark</p>
<pre><code>kube-bench run --targets=master
kube-bench run --targets=node
</code></pre>
<p>Verify Binaries</p>
<pre><code>sha512sum /usr/bin/kubelet
cat compare | uniq
</code></pre>
<p>Open Policy Agent</p>
<pre><code>k edit blacklistimages pod-trusted-images
k edit constrainttemplates blacklistimages
</code></pre>
<p>Secure Kubernetes Dashboard</p>
<ul>
<li><a href=https://github.com/kubernetes/dashboard/tree/master/docs>https://github.com/kubernetes/dashboard/tree/master/docs</a></li>
<li>k -n kubernetes-dashboard get pod,svc</li>
</ul>
<pre><code>k -n kubernetes-dashboard edit deploy kubernetes-dashboard
</code></pre>
<pre><code>  template:
    spec:
      containers:
      - args:
        - --namespace=kubernetes-dashboard
        - --authentication-mode=token        # change or delete, &quot;token&quot; is default
        - --auto-generate-certificates       # add
        #- --enable-skip-login=true          # delete or set to false
        #- --enable-insecure-login           # delete
        image: kubernetesui/dashboard:v2.0.3
        imagePullPolicy: Always
        name: kubernetes-dashboard
</code></pre>
<p>AppArmor</p>
<ul>
<li>
<p><a href=https://kubernetes.io/docs/tutorials/security/apparmor/>AppArmor</a></p>
<ul>
<li>apparmor_parser</li>
<li>aa-status</li>
</ul>
</li>
<li>
<p><a href=https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#create-a-pod-that-gets-scheduled-to-your-chosen-node>nodeSelector</a></p>
</li>
</ul>
<p>gVisor</p>
<ul>
<li><a href=https://kubernetes.io/docs/concepts/containers/runtime-class>RuntimeClasses</a></li>
</ul>
<pre><code>apiVersion: node.k8s.io/v1
kind: RuntimeClass
metadata:
  name: gvisor
handler: runsc
</code></pre>
<p>Pod:</p>
<pre><code>apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: gvisor-test
  name: gvisor-test
  namespace: team-purple
spec:
  nodeName: cluster1-node2 # add
  runtimeClassName: gvisor   # add
  containers:
  - image: nginx:1.19.2
    name: gvisor-test
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Always
status: {}
</code></pre>
<p>ETCD</p>
<ul>
<li><a href=https://etcd.io/docs/v3.5/op-guide/etcdctl/>etcdctl</a></li>
</ul>
<pre><code>cat /etc/kubernetes/manifests/kube-apiserver.yaml | grep etcd
ETCDCTL_API=3 etcdctl \
--cert /etc/kubernetes/pki/apiserver-etcd-client.crt \
--key /etc/kubernetes/pki/apiserver-etcd-client.key \
--cacert /etc/kubernetes/pki/etcd/ca.crt get /registry/{type}/{namespace}/{name}
</code></pre>
<p>Permission escalation</p>
<pre><code>k -n restricted get role,rolebinding,clusterrole,clusterrolebinding
k -n restricted get secrets -o yaml

k -n restricted get pod -o yaml | grep -i secret

# via volume
k -n restricted exec pod1-fd5d64b9c-pcx6q -- cat /etc/secret-volume/password

# via env
k -n restricted exec pod2-6494f7699b-4hks5 -- env | grep PASS

# via API
k -n restricted exec -it pod3-748b48594-24s76 -- sh
curl https://kubernetes.default/api/v1/namespaces/restricted/secrets -H &quot;Authorization: Bearer $(cat /run/secrets/kubernetes.io/serviceaccount/token)&quot; -k
</code></pre>
<p>Network Policies</p>
<ul>
<li><a href=https://kubernetes.io/docs/concepts/services-networking/network-policies/>Network Policies</a></li>
</ul>
<pre><code>apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: metadata-deny
  namespace: metadata-access
spec:
  podSelector: {}
  policyTypes:
  - Egress
  egress:
  - to:
    - ipBlock:
        cidr: 0.0.0.0/0
        except:
        - 192.168.100.21/32
</code></pre>
<pre><code>apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: metadata-allow
  namespace: metadata-access
spec:
  podSelector:
    matchLabels:
      role: metadata-accessor
  policyTypes:
  - Egress
  egress:
  - to:
    - ipBlock:
        cidr: 192.168.100.21/32
</code></pre>
<p>Syscall</p>
<pre><code>strace -p &lt;pid&gt;
</code></pre>
<p>Ingress TLS</p>
<pre><code>k -n &lt;namespace&gt; create secret tls tls-secret --key tls.key --cert tls.crt
</code></pre>
<p>Audit log</p>
<ul>
<li><a href=https://kubernetes.io/docs/tasks/debug-application-cluster/audit/>Audit log</a></li>
</ul>
<pre><code># /etc/kubernetes/audit/policy.yaml
apiVersion: audit.k8s.io/v1
kind: Policy
rules:

# log Secret resources audits, level Metadata
- level: Metadata
  resources:
  - group: &quot;&quot;
    resources: [&quot;secrets&quot;]

# log node related audits, level RequestResponse
- level: RequestResponse
  userGroups: [&quot;system:nodes&quot;]

# for everything else don't log anything
- level: None
</code></pre>
<p>Other</p>
<p><a href=https://kubernetes.io/docs/tasks/administer-cluster/securing-a-cluster/>Securing a Cluster</a>:</p>
<ul>
<li>
<p><a href=https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction>NodeRestriction</a></p>
</li>
<li>
<p><a href=https://kubernetes.io/docs/tasks/debug/debug-cluster/audit/#log-backend>Audit logs</a></p>
</li>
<li>
<p><a href=https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/#normal-user>CSR</a></p>
<ul>
<li><a href=https://kubernetes.io/docs/tasks/administer-cluster/certificates/#openssl>openssl</a></li>
</ul>
</li>
<li>
<p><a href=https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/#understanding-the-encryption-at-rest-configuration>EncryptionConfiguration</a></p>
<ul>
<li>kubectl -n one get secrets -o json | kubectl replace -f - recreate secrets</li>
</ul>
</li>
<li>
<p><a href=https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#imagepolicywebhook>ImagePolicyWebhook</a></p>
</li>
</ul>
<p>Notes:</p>
<p>Set client credentials:</p>
<pre><code>k config set-credentials 60099@internal.users --client-key=60099.key --client-certificate=60099.crt
k config set-context 60099@internal.users --cluster=kubernetes --user=60099@internal.users
k config get-contexts
k config use-context 60099@internal.users
</code></pre>
<p>Logs:</p>
<pre><code>crictl logs &lt;container-id&gt;
cat /var/log/pods/&lt;pod-id&gt;/&lt;container-name&gt;/0.log
</code></pre>
<p>Common:</p>
<pre><code>watch crictl ps

# We can contact the Apiserver as the Kubelet by using the Kubelet kubeconfig
export KUBECONFIG=/etc/kubernetes/kubelet.conf
</code></pre>
<p>Docker:</p>
<pre><code># shared PID namespace
docker run --name nginx -d --pid=container:app1 nginx
</code></pre>
</div>
<footer class=post-footer>
<div class=post-meta>
<time datetime=" 2025-01-08" itemprop=datePublished>Jan 8, 2025</time>
</div>
</footer>
</article>
</div><script src=https://cdn.jsdelivr.net/npm/prismjs@1.24.1/prism.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/prismjs@1.24.1/plugins/filter-highlight-all/prism-filter-highlight-all.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/prismjs@1.24.1/plugins/autoloader/prism-autoloader.min.js></script>
<script>Prism.plugins.filterHighlightAll.add(function(a){return a.language!=="mermaid"})</script>
<script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.init({startOnLoad:!0},"pre code.language-mermaid",function(){const a=document.querySelectorAll('code.language-mermaid');for(const c of a){c.style.backgroundColor='initial';const b=c.parentNode;b.style.border='none',b.style.textAlign='center',window.darkmode&&!window.darkmode.isActivated()&&(b.style.backgroundColor='initial')}})</script>
</div>
</main><footer class=site-footer>
<div class=wrapper>
<div class=social-links>
<a class="social-link social-github" href=https://github.com/mayocream><svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="currentcolor" d="M12 2A10 10 0 002 12c0 4.42 2.87 8.17 6.84 9.5C9.34 21.58 9.5 21.27 9.5 21 9.5 20.77 9.5 20.14 9.5 19.31 6.73 19.91 6.14 17.97 6.14 17.97c-.46-1.16-1.11-1.47-1.11-1.47C4.12 15.88 5.1 15.9 5.1 15.9 6.1 15.97 6.63 16.93 6.63 16.93 7.5 18.45 8.97 18 9.54 17.76 9.63 17.11 9.89 16.67 10.17 16.42c-2.22-.25-4.55-1.11-4.55-4.92.0-1.11.38-2 1.03-2.71C6.55 8.54 6.2 7.5 6.75 6.15c0 0 .84-.27 2.75 1.02C10.29 6.95 11.15 6.84 12 6.84s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02C17.8 7.5 17.45 8.54 17.35 8.79 18 9.5 18.38 10.39 18.38 11.5c0 3.82-2.34 4.66-4.57 4.91C14.17 16.72 14.5 17.33 14.5 18.26c0 1.34.0 2.42.0 2.74.0.27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0012 2z"/></svg>
</a>
<a class="social-link social-rss" href=/index.xml target=_blank><svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="currentcolor" d="M6.18 15.64a2.18 2.18.0 012.18 2.18C8.36 19 7.38 20 6.18 20 5 20 4 19 4 17.82a2.18 2.18.0 012.18-2.18M4 4.44A15.56 15.56.0 0119.56 20H16.73A12.73 12.73.0 004 7.27V4.44M4 10.1A9.9 9.9.0 0113.9 20H11.07A7.07 7.07.0 004 12.93V10.1z"/></svg>
</a>
</div>
<div class=credits>
Theme KAGAMI by Kamikat
</div>
</div>
</footer><script>(function(a){for(var a=Array.prototype.slice.call(document.getElementsByClassName('baseline-fix')),b=0,c;b!=a.length;b++)c=a[b],c.innerHTML=c.innerHTML.replace(/[\u2000-\u206e‚∏Ä-\u2e7e‚∫Ä-\u2efe‚ºÄ-\u2fde‚ø∞-\u2ffe\u3000-„Äæ\u3040-„Çû„Ç†-„Éæ\u3100-\u312e\u3130-„Üé„Üê-„Üû„Ü†-\u31be„áÄ-\u31ee„á∞-„áæ„àÄ-„ãæ„åÄ-„èæ„êÄ-\u4dbe‰∏Ä-\u9ffe\ua960-\ua97eÍ∞Ä-\ud7ae\ud7b0-\ud7feÔ§Ä-\ufafeÔ∏∞-Ôπé\uff00-ÔøÆ]|[\ud840-\ud868\ud86a-\ud86c][\udc00-\udfff]|\ud82c[\udc00-\udcfe]|\ud869[\udc00-\udede\udf00-\udfff]|\ud86d[\udc00-\udf3e\udf40-\udfff]|\ud86e[\udc00-\udc1e]|\ud87e[\udc00-\ude1e]/g,function(a){return'<span class="baseline-fix-block">'+a+'<'+'/span>'}),c.classList.remove('baseline-fix')})(Array.prototype.slice.call(document.getElementsByClassName('baseline-fix')))</script>
<script type=text/javascript>const resize=function(){this.width=.5*(this.naturalWidth||this.width)};Array.prototype.forEach.call(document.querySelectorAll('.half-size, .retina2x'),function(a){a.naturalWidth?resize.call(a):a.onload=resize})</script>
<script src=https://cdn.jsdelivr.net/npm/twemoji@13.1.0/dist/twemoji.min.js></script>
<script>twemoji.parse(document.body,{folder:'svg',ext:'.svg'})</script>
</body>